let fe;(function(){const p={};let e,t=new Uint8Array;function i(){return t.byteLength===0&&(t=new Uint8Array(e.memory.buffer)),t}let n=0;function g(a,f){const l=f(a.length*1);return i().set(a,l/1),n=a.length,l}p.init_pagefind=function(a){const f=g(a,e.__wbindgen_malloc),l=n;return e.init_pagefind(f,l)},p.load_index_chunk=function(a,f){const l=g(f,e.__wbindgen_malloc),c=n;return e.load_index_chunk(a,l,c)},p.load_filter_chunk=function(a,f){const l=g(f,e.__wbindgen_malloc),c=n;return e.load_filter_chunk(a,l,c)};const m=new TextEncoder("utf-8"),b=typeof m.encodeInto=="function"?function(a,f){return m.encodeInto(a,f)}:function(a,f){const l=m.encode(a);return f.set(l),{read:a.length,written:l.length}};function k(a,f,l){if(l===void 0){const P=m.encode(a),$=f(P.length);return i().subarray($,$+P.length).set(P),n=P.length,$}let c=a.length,w=f(c);const x=i();let y=0;for(;y<c;y++){const P=a.charCodeAt(y);if(P>127)break;x[w+y]=P}if(y!==c){y!==0&&(a=a.slice(y)),w=l(w,c,c=y+a.length*3);const P=i().subarray(w+y,w+c),$=b(a,P);y+=$.written}return n=y,w}p.add_synthetic_filter=function(a,f){const l=k(f,e.__wbindgen_malloc,e.__wbindgen_realloc),c=n;return e.add_synthetic_filter(a,l,c)};let W=new Int32Array;function A(){return W.byteLength===0&&(W=new Int32Array(e.memory.buffer)),W}const q=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});q.decode();function E(a,f){return q.decode(i().subarray(a,a+f))}p.request_indexes=function(a,f){try{const w=e.__wbindgen_add_to_stack_pointer(-16),x=k(f,e.__wbindgen_malloc,e.__wbindgen_realloc),y=n;e.request_indexes(w,a,x,y);var l=A()[w/4+0],c=A()[w/4+1];return E(l,c)}finally{e.__wbindgen_add_to_stack_pointer(16),e.__wbindgen_free(l,c)}},p.request_filter_indexes=function(a,f){try{const w=e.__wbindgen_add_to_stack_pointer(-16),x=k(f,e.__wbindgen_malloc,e.__wbindgen_realloc),y=n;e.request_filter_indexes(w,a,x,y);var l=A()[w/4+0],c=A()[w/4+1];return E(l,c)}finally{e.__wbindgen_add_to_stack_pointer(16),e.__wbindgen_free(l,c)}},p.request_all_filter_indexes=function(a){try{const c=e.__wbindgen_add_to_stack_pointer(-16);e.request_all_filter_indexes(c,a);var f=A()[c/4+0],l=A()[c/4+1];return E(f,l)}finally{e.__wbindgen_add_to_stack_pointer(16),e.__wbindgen_free(f,l)}},p.filters=function(a){try{const c=e.__wbindgen_add_to_stack_pointer(-16);e.filters(c,a);var f=A()[c/4+0],l=A()[c/4+1];return E(f,l)}finally{e.__wbindgen_add_to_stack_pointer(16),e.__wbindgen_free(f,l)}},p.search=function(a,f,l,c,w){try{const P=e.__wbindgen_add_to_stack_pointer(-16),$=k(f,e.__wbindgen_malloc,e.__wbindgen_realloc),Y=n,H=k(l,e.__wbindgen_malloc,e.__wbindgen_realloc),Q=n,X=k(c,e.__wbindgen_malloc,e.__wbindgen_realloc),Z=n;e.search(P,a,$,Y,H,Q,X,Z,w);var x=A()[P/4+0],y=A()[P/4+1];return E(x,y)}finally{e.__wbindgen_add_to_stack_pointer(16),e.__wbindgen_free(x,y)}};async function F(a,f){if(typeof Response=="function"&&a instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(a,f)}catch(c){if(a.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",c);else throw c}const l=await a.arrayBuffer();return await WebAssembly.instantiate(l,f)}else{const l=await WebAssembly.instantiate(a,f);return l instanceof WebAssembly.Instance?{instance:l,module:a}:l}}function S(){const a={};return a.wbg={},a}function T(a,f){return e=a.exports,h.__wbindgen_wasm_module=f,W=new Int32Array,t=new Uint8Array,e}function R(a){const f=S();a instanceof WebAssembly.Module||(a=new WebAssembly.Module(a));const l=new WebAssembly.Instance(a,f);return T(l,a)}async function h(a){if(typeof a>"u"){let w;typeof document>"u"?w=location.href:w=document.currentScript.src,a=w.replace(/\.js$/,"_bg.wasm")}const f=S();(typeof a=="string"||typeof Request=="function"&&a instanceof Request||typeof URL=="function"&&a instanceof URL)&&(a=fetch(a));const{instance:l,module:c}=await F(await a,f);return T(l,c)}fe=Object.assign(h,{initSync:R},p)})();let ke;(()=>{var p=Uint8Array,e=Uint16Array,t=Uint32Array,i=new p([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),n=new p([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),g=new p([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),m=function(r,s){for(var o=new e(31),d=0;d<31;++d)o[d]=s+=1<<r[d-1];for(var _=new t(o[30]),d=1;d<30;++d)for(var I=o[d];I<o[d+1];++I)_[I]=I-o[d]<<5|d;return[o,_]},b=m(i,2),k=b[0],W=b[1];k[28]=258,W[258]=28;var A=m(n,0),q=A[0],E=new e(32768);for(h=0;h<32768;++h)F=(h&43690)>>>1|(h&21845)<<1,F=(F&52428)>>>2|(F&13107)<<2,F=(F&61680)>>>4|(F&3855)<<4,E[h]=((F&65280)>>>8|(F&255)<<8)>>>1;var F,h,S=function(r,s,o){for(var d=r.length,_=0,I=new e(s);_<d;++_)r[_]&&++I[r[_]-1];var B=new e(s);for(_=0;_<s;++_)B[_]=B[_-1]+I[_-1]<<1;var U;if(o){U=new e(1<<s);var u=15-s;for(_=0;_<d;++_)if(r[_])for(var v=_<<4|r[_],D=s-r[_],j=B[r[_]-1]++<<D,O=j|(1<<D)-1;j<=O;++j)U[E[j]>>>u]=v}else for(U=new e(d),_=0;_<d;++_)r[_]&&(U[_]=E[B[r[_]-1]++]>>>15-r[_]);return U},T=new p(288);for(h=0;h<144;++h)T[h]=8;var h;for(h=144;h<256;++h)T[h]=9;var h;for(h=256;h<280;++h)T[h]=7;var h;for(h=280;h<288;++h)T[h]=8;var h,R=new p(32);for(h=0;h<32;++h)R[h]=5;var h,a=S(T,9,1),f=S(R,5,1),l=function(r){for(var s=r[0],o=1;o<r.length;++o)r[o]>s&&(s=r[o]);return s},c=function(r,s,o){var d=s/8|0;return(r[d]|r[d+1]<<8)>>(s&7)&o},w=function(r,s){var o=s/8|0;return(r[o]|r[o+1]<<8|r[o+2]<<16)>>(s&7)},x=function(r){return(r+7)/8|0},y=function(r,s,o){(s==null||s<0)&&(s=0),(o==null||o>r.length)&&(o=r.length);var d=new(r.BYTES_PER_ELEMENT==2?e:r.BYTES_PER_ELEMENT==4?t:p)(o-s);return d.set(r.subarray(s,o)),d},P=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],$=function(r,s,o){var d=new Error(s||P[r]);if(d.code=r,Error.captureStackTrace&&Error.captureStackTrace(d,$),!o)throw d;return d},Y=function(r,s,o){var d=r.length;if(!d||o&&o.f&&!o.l)return s||new p(0);var _=!s||o,I=!o||o.i;o||(o={}),s||(s=new p(d*3));var B=function(me){var ye=s.length;if(me>ye){var be=new p(Math.max(ye*2,me));be.set(s),s=be}},U=o.f||0,u=o.p||0,v=o.b||0,D=o.l,j=o.d,O=o.m,J=o.n,ee=d*8;do{if(!D){U=c(r,u,1);var te=c(r,u+1,3);if(u+=3,te)if(te==1)D=a,j=f,O=9,J=5;else if(te==2){var ae=c(r,u,31)+257,he=c(r,u+10,15)+4,de=ae+c(r,u+5,31)+1;u+=14;for(var G=new p(de),ie=new p(19),M=0;M<he;++M)ie[g[M]]=c(r,u+M*3,7);u+=he*3;for(var ue=l(ie),Fe=(1<<ue)-1,Se=S(ie,ue,1),M=0;M<de;){var _e=Se[c(r,u,Fe)];u+=_e&15;var L=_e>>>4;if(L<16)G[M++]=L;else{var N=0,V=0;for(L==16?(V=3+c(r,u,3),u+=2,N=G[M-1]):L==17?(V=3+c(r,u,7),u+=3):L==18&&(V=11+c(r,u,127),u+=7);V--;)G[M++]=N}}var ge=G.subarray(0,ae),C=G.subarray(ae);O=l(ge),J=l(C),D=S(ge,O,1),j=S(C,J,1)}else $(1);else{var L=x(u)+4,re=r[L-4]|r[L-3]<<8,ne=L+re;if(ne>d){I&&$(0);break}_&&B(v+re),s.set(r.subarray(L,ne),v),o.b=v+=re,o.p=u=ne*8,o.f=U;continue}if(u>ee){I&&$(0);break}}_&&B(v+131072);for(var Ae=(1<<O)-1,Ee=(1<<J)-1,se=u;;se=u){var N=D[w(r,u)&Ae],z=N>>>4;if(u+=N&15,u>ee){I&&$(0);break}if(N||$(2),z<256)s[v++]=z;else if(z==256){se=u,D=null;break}else{var we=z-254;if(z>264){var M=z-257,K=i[M];we=c(r,u,(1<<K)-1)+k[M],u+=K}var oe=j[w(r,u)&Ee],le=oe>>>4;oe||$(3),u+=oe&15;var C=q[le];if(le>3){var K=n[le];C+=w(r,u)&(1<<K)-1,u+=K}if(u>ee){I&&$(0);break}_&&B(v+131072);for(var pe=v+we;v<pe;v+=4)s[v]=s[v-C],s[v+1]=s[v+1-C],s[v+2]=s[v+2-C],s[v+3]=s[v+3-C];v=pe}}o.l=D,o.p=se,o.b=v,o.f=U,D&&(U=1,o.m=O,o.d=j,o.n=J)}while(!U);return v==s.length?s:y(s,0,v)},H=new p(0),Q=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&$(6,"invalid gzip data");var s=r[3],o=10;s&4&&(o+=r[10]|(r[11]<<8)+2);for(var d=(s>>3&1)+(s>>4&1);d>0;d-=!r[o++]);return o+(s&2)},X=function(r){var s=r.length;return(r[s-4]|r[s-3]<<8|r[s-2]<<16|r[s-1]<<24)>>>0};function Z(r,s){return Y(r.subarray(Q(r),-8),s||new p(X(r)))}var $e=typeof TextDecoder<"u"&&new TextDecoder,xe=0;try{$e.decode(H,{stream:!0}),xe=1}catch{}ke=Z})();const ce="0.9.1",Pe=async(p=100)=>new Promise(e=>setTimeout(e,p));class ve{constructor(e={}){this.backend=fe,this.decoder=new TextDecoder("utf-8"),this.wasm=null,this.basePath=e.basePath||"/_pagefind/",this.primary=e.primary||!1,this.primary&&this.initPrimary(),/[^\/]$/.test(this.basePath)&&(this.basePath=`${this.basePath}/`),window?.location?.origin&&this.basePath.startsWith(window.location.origin)&&(this.basePath=this.basePath.replace(window.location.origin,"")),this.baseUrl=e.baseUrl||this.defaultBasePath(),/^(\/|https?:\/\/)/.test(this.baseUrl)||(this.baseUrl=`/${this.baseUrl}`),this.indexWeight=e.indexWeight??1,this.mergeFilter=e.mergeFilter??{},this.loaded_chunks={},this.loaded_filters={},this.loaded_fragments={},this.raw_ptr=null,this.searchMeta=null,this.languages=null}initPrimary(){try{this.basePath||(this.basePath=import.meta.url.match(/^(.*\/)pagefind.js.*$/)[1])}catch{console.warn("Pagefind couldn't determine the base of the bundle from the import path. Falling back to the default.")}}defaultBasePath(){return this.basePath.match(/^(.*\/)_pagefind/)?.[1]||"/"}async options(e){const t=["basePath","baseUrl","indexWeight","mergeFilter"];for(const[i,n]of Object.entries(e))if(i==="mergeFilter"){let g=this.stringifyFilters(n),m=await this.getPtr();this.raw_ptr=this.backend.add_synthetic_filter(m,g)}else t.includes(i)?this[i]=n:console.warn(`Unknown Pagefind option ${i}. Allowed options: [${t.join(", ")}]`)}decompress(e,t="unknown file"){return this.decoder.decode(e.slice(0,12))==="pagefind_dcd"?e.slice(12):(e=ke(e),this.decoder.decode(e.slice(0,12))!=="pagefind_dcd"?(console.error(`Decompressing ${t} appears to have failed: Missing signature`),e):e.slice(12))}async init(e,t){await this.loadEntry();let i=this.findIndex(e),n=i.wasm?i.wasm:"unknown",g=[this.loadMeta(i.hash)];t.load_wasm===!0&&g.push(this.loadWasm(n)),await Promise.all(g),this.raw_ptr=this.backend.init_pagefind(new Uint8Array(this.searchMeta))}async loadEntry(){try{let e=await fetch(`${this.basePath}pagefind-entry.json?ts=${Date.now()}`);e=await e.json(),this.languages=e.languages,e.version!==ce&&(this.primary?console.warn(["Pagefind JS version doesn't match the version in your search index.",`Pagefind JS: ${ce}. Pagefind index: ${e.version}`,"If you upgraded Pagefind recently, you likely have a cached pagefind.js file.","If you encounter any search errors, try clearing your cache."].join(`
`)):console.warn(["Merging a Pagefind index from a different version than the main Pagefind instance.",`Main Pagefind JS: ${ce}. Merged index (${this.basePath}): ${e.version}`,"If you encounter any search errors, make sure that both sites are running the same version of Pagefind."].join(`
`)))}catch(e){throw console.error(`Failed to load Pagefind metadata:
${e.toString()}`),new Error("Failed to load Pagefind metadata")}}findIndex(e){if(this.languages){let t=this.languages[e];if(t||(t=this.languages[e.split("-")[0]],t))return t;let i=Object.values(this.languages).sort((n,g)=>g.page_count-n.page_count);if(i[0])return i[0]}throw new Error("Pagefind Error: No language indexes found.")}async loadMeta(e){try{let t=await fetch(`${this.basePath}pagefind.${e}.pf_meta`);t=await t.arrayBuffer(),this.searchMeta=this.decompress(new Uint8Array(t),"Pagefind metadata")}catch(t){console.error(`Failed to load the meta index:
${t.toString()}`)}}async loadWasm(e){try{const t=`${this.basePath}wasm.${e}.pagefind`;let i=await fetch(t);i=await i.arrayBuffer();const n=this.decompress(new Uint8Array(i),"Pagefind WebAssembly");this.wasm=await this.backend(n)}catch(t){console.error(`Failed to load the Pagefind WASM:
${t.toString()}`)}}async _loadGenericChunk(e,t){try{let i=await fetch(e);i=await i.arrayBuffer();let n=this.decompress(new Uint8Array(i),e),g=await this.getPtr();this.raw_ptr=this.backend[t](g,n)}catch(i){console.error(`Failed to load the index chunk ${e}:
${i.toString()}`)}}async loadChunk(e){if(!this.loaded_chunks[e]){const t=`${this.basePath}index/${e}.pf_index`;this.loaded_chunks[e]=this._loadGenericChunk(t,"load_index_chunk")}return await this.loaded_chunks[e]}async loadFilterChunk(e){if(!this.loaded_filters[e]){const t=`${this.basePath}filter/${e}.pf_filter`;this.loaded_filters[e]=this._loadGenericChunk(t,"load_filter_chunk")}return await this.loaded_filters[e]}async _loadFragment(e){let t=await fetch(`${this.basePath}fragment/${e}.pf_fragment`);t=await t.arrayBuffer();let i=this.decompress(new Uint8Array(t),`Fragment ${e}`);return JSON.parse(new TextDecoder().decode(i))}async loadFragment(e,t=[0,0],i=[]){this.loaded_fragments[e]||(this.loaded_fragments[e]=this._loadFragment(e));let n=await this.loaded_fragments[e];n.raw_content||(n.raw_content=n.content,n.content=n.content.replace(/\u200B/g,""));let g=n.raw_content.includes("\u200B"),m=[];g?m=n.raw_content.split("\u200B"):m=n.raw_content.split(/[\r\n\s]+/g);for(let b of i)m[b]=`<mark>${m[b]}</mark>`;return n.excerpt=m.slice(t[0],t[0]+t[1]).join(g?"":" ").trim(),n.raw_url||(n.raw_url=n.url,n.url=this.fullUrl(n.raw_url)),n}fullUrl(e){return`${this.baseUrl}/${e}`.replace(/\/+/g,"/")}async getPtr(){for(;this.raw_ptr===null;)await Pe(50);if(!this.raw_ptr)throw console.error("Pagefind: WASM Error (No pointer)"),new Error("Pagefind: WASM Error (No pointer)");return this.raw_ptr}parseFilters(e){let t={};if(!e)return t;for(const i of e.split("__PF_FILTER_DELIM__")){let[n,g]=i.split(/:(.*)$/);if(t[n]={},g){for(const m of g.split("__PF_VALUE_DELIM__"))if(m){let[,b,k]=m.match(/^(.*):(\d+)$/);t[n][b]=parseInt(k)??k}}}return t}stringifyFilters(e={}){let t=[];for(let[i,n]of Object.entries(e))if(Array.isArray(n))for(let g of n)t.push(`${i}:${g}`);else t.push(`${i}:${n}`);return t.join("__PF_FILTER_DELIM__")}stringifySorts(e={}){let t=Object.entries(e);for(let[i,n]of t)return t.length>1&&console.warn(`Pagefind was provided multiple sort options in this search, but can only operate on one. Using the ${i} sort.`),n!=="asc"&&n!=="desc"&&console.warn(`Pagefind was provided a sort with unknown direction ${n}. Supported: [asc, desc]`),`${i}:${n}`;return""}async filters(){let e=await this.getPtr(),t=this.backend.request_all_filter_indexes(e).split(" ").filter(n=>n).map(n=>this.loadFilterChunk(n));await Promise.all([...t]),e=await this.getPtr();let i=this.backend.filters(e);return this.parseFilters(i)}async preload(e,t={}){t.preload=!0,await this.search(e,t)}async search(e,t={}){t={verbose:!1,filters:{},sort:{},...t};const i=l=>{t.verbose&&console.log(l)};i(`Starting search on ${this.basePath}`);let n=Date.now(),g=await this.getPtr(),m=e===null;e=e??"";let b=/^\s*".+"\s*$/.test(e);if(b&&i("Running an exact search"),e=e.toLowerCase().trim().replace(/[\.`~!@#\$%\^&\*\(\)\{\}\[\]\\\|:;'",<>\/\?\-]/g,"").replace(/\s{2,}/g," ").trim(),i(`Normalized search term to ${e}`),!e?.length&&!m)return{results:[],filters:{},timings:{preload:Date.now()-n,search:Date.now()-n,total:Date.now()-n}};let k=this.stringifySorts(t.sort);i(`Stringified sort to ${k}`);const W=this.stringifyFilters(t.filters);i(`Stringified filters to ${W}`);let A=this.backend.request_indexes(g,e).split(" ").filter(l=>l).map(l=>this.loadChunk(l)),q=this.backend.request_filter_indexes(g,W).split(" ").filter(l=>l).map(l=>this.loadFilterChunk(l));if(await Promise.all([...A,...q]),i("Loaded necessary chunks to run search"),t.preload){i("Preload \u2014 bailing out of search operation now.");return}g=await this.getPtr();let E=Date.now(),F=this.backend.search(g,e,W,k,b);i(`Got the raw search result: ${F}`);let[S,T]=F.split(/:(.*)$/),R=this.parseFilters(T);i(`Remaining filters: ${JSON.stringify(F)}`),S=S.length?S.split(" "):[];let h=S.map(l=>{let[c,w,x,y]=l.split("@");return i(`Processing result: 
  hash:${c}
  score:${w}
  excerpt:${x}
  locations:${y}`),y=y.split(",").map(P=>parseInt(P)),x=x.split(",").map(P=>parseInt(P)),{id:c,score:parseFloat(w)*this.indexWeight,words:y,excerpt_range:x,data:async()=>await this.loadFragment(c,x,y)}});const a=Date.now()-E,f=Date.now()-n;return i(`Found ${S.length} result${S.length==1?"":"s"} for "${e}" in ${Date.now()-E}ms (${Date.now()-n}ms realtime)`),{results:h,filters:R,timings:{preload:f-a,search:a,total:f}}}}class Ie{constructor(e={}){this.backend=fe,this.primaryLanguage="unknown",this.primary=new ve({...e,primary:!0}),this.instances=[this.primary],this.init()}async options(e){await this.primary.options(e)}async init(){if(document?.querySelector){const e=document.querySelector("html").getAttribute("lang")||"unknown";this.primaryLanguage=e.toLocaleLowerCase()}await this.primary.init(this.primaryLanguage,{load_wasm:!0})}async mergeIndex(e,t={}){if(this.primary.basePath.startsWith(e)){console.warn(`Skipping mergeIndex ${e} that appears to be the same as the primary index (${this.primary.basePath})`);return}let i=new ve({primary:!1,basePath:e});for(this.instances.push(i);this.primary.wasm===null;)await Pe(50);await i.init(t.language||this.primaryLanguage,{load_wasm:!1}),delete t.language,await i.options(t)}mergeFilters(e){const t={};for(const i of e)for(const[n,g]of Object.entries(i))if(t[n]){const m=t[n];for(const[b,k]of Object.entries(m))m[b]=(m[b]||0)+k}else{t[n]=g;continue}return t}async filters(){let e=await Promise.all(this.instances.map(t=>t.filters()));return this.mergeFilters(e)}async preload(e,t={}){await Promise.all(this.instances.map(i=>i.preload(e,t)))}async search(e,t={}){let i=await Promise.all(this.instances.map(b=>b.search(e,t)));const n=this.mergeFilters(i.map(b=>b.filters)),g=i.map(b=>b.results).flat().sort((b,k)=>k.score-b.score),m=i.map(b=>b.timings);return{results:g,filters:n,timings:m}}}export{Ie as Pagefind};
